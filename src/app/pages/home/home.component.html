<div class="home-content">
  <h1>Formula</h1>
  <nav class="tag-nav">
    <ul>
      <li>
        <a [attr.href]="'#' + getAnchorId('Elements of a Formula')">Elements of a Formula</a>
      </li>
      <li *ngFor="let tag of uniqueTags">
        <a [attr.href]="'#' + getAnchorId(tag)">{{ tag }} Functions</a>
      </li>
      <li>
        <a [attr.href]="'#' + getAnchorId('Operators')">Operators</a>
      </li>
      <li>
        <a [attr.href]="'#' + getAnchorId('Global Variables')">Global Variables</a>
      </li>
    </ul>
  </nav>

  <!-- Elements of a Formula Section -->
  <section class="doc-subsection" *ngIf="formulaElements">
    <h2 class="doc-title" [attr.id]="getAnchorId('Formula Elements')">{{ formulaElements.title }}</h2>
    <p>{{ formulaElements.description }}</p>
    <table class="doc-tables two-columns">
      <thead>
        <tr>
          <th>Element</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of formulaElements.elements">
          <td>{{ item.element }}</td>
          <td>{{ item.description }}</td>
        </tr>
      </tbody>
    </table>
  </section>
  <!-- Functions grouped by tag -->
  <div *ngFor="let tag of uniqueTags">
    <h2 [attr.id]="getAnchorId(tag)">{{ tag }} Functions</h2>
    <table class="doc-tables two-columns">
      <thead>
        <tr>
          <th>Function Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let funcName of itemsByTag[tag]">
          <td>
            <a (click)="goToFunction(funcName.toLowerCase())">{{ funcName }}</a>
          </td>
          <td [innerHTML]="functionDescriptions[funcName] || 'Loading...'"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Operators Section -->
  <section *ngIf="operators && objectKeys(operators).length" [attr.id]="getAnchorId('Operators')">
    <div *ngFor="let group of operators | keyvalue">
      <h2>{{ group.key }}</h2>
      <table class="doc-tables three-columns">
        <thead>
          <tr>
            <th>Operator</th>
            <th>Type</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let operator of group.value">
            <td>{{ operator.operator }}</td>
            <td>{{ operator.name }}</td>
            <td>{{ operator.description }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <section
    class="doc-subsection"
    *ngIf="globalVariables && globalVariables.length"
  >
    <h2 [attr.id]="getAnchorId('Global Variables')">Global Variables</h2>
    <table class="doc-tables three-columns">
      <thead>
        <tr>
          <th>Variable</th>
          <th>Description</th>
          <th>Example Value</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let variable of globalVariables">
          <td>{{ variable.variable }}</td>
          <td>{{ variable.description }}</td>
          <td>
            <ng-container
              *ngIf="variable.variable === '$JOINER'; else normalValue"
            >
              <a [routerLink]="['/docs', '$joiner']">{{
                variable.exampleValue
              }}</a>
            </ng-container>
            <ng-template #normalValue>
              {{ variable.exampleValue }}
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </section>
</div>
